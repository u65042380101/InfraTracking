{% extends "base.html" %}

{% block title %}แก้ไขข้อมูล Helpdesk Record{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto py-12 px-6">
  <h2 class="text-3xl font-bold text-center text-blue-700 mb-8">✏️ แก้ไขข้อมูล Helpdesk Record</h2>

  {% if messages %}
    <div class="mb-6 space-y-2">
      {% for message in messages %}
      <div class="bg-green-100 border border-green-300 text-green-800 px-4 py-3 rounded shadow">
        {{ message }}
      </div>
      {% endfor %}
    </div>
  {% endif %}

  <form method="post" class="bg-white p-8 rounded-2xl shadow-lg border border-gray-200 space-y-6">
    {% csrf_token %}

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <div>
        <label class="block text-gray-700 font-semibold mb-1">รหัสสาขา</label>
        {{ form.branch_code }}
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">ชื่อสาขา</label>
        {{ form.branch_name }}
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">อุปกรณ์</label>
        {{ form.device }}
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">ผู้ให้บริการ</label>
        {{ form.provider }}
      </div>
      <div class="md:col-span-2">
        <label class="block text-gray-700 font-semibold mb-1">ปัญหา</label>
        {{ form.problem }}
      </div>
      <div class="md:col-span-2">
        <label class="block text-gray-700 font-semibold mb-1">แนวทางแก้ไข</label>
        {{ form.solution }}
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">วันที่</label>
        {{ form.date }}
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">ผู้บันทึก</label>
        {{ form.by }}
      </div>
      <div>
        <label class="block text-gray-700 font-semibold mb-1">สถานะ</label>
        {{ form.status }}
      </div>
    </div>

    <div class="pt-8 text-center">
      <button type="submit" class="inline-flex items-center bg-yellow-600 hover:bg-yellow-700 text-white font-semibold px-6 py-2 rounded-lg shadow transition duration-150">
        ✏️ บันทึกการแก้ไข
      </button>
      {% if form.instance.branch_code %}
        <a href="{% url 'helpdesk_record' form.instance.branch_code %}" 
           class="ml-4 inline-block bg-red-500 hover:bg-red-600 text-white font-semibold px-6 py-2 rounded-lg shadow transition duration-150">
          ยกเลิก
        </a>
      {% else %}
        <a href="{% url 'dashboard' %}" 
           class="ml-4 inline-block bg-red-500 hover:bg-red-600 text-white font-semibold px-6 py-2 rounded-lg shadow transition duration-150">
          ยกเลิก
        </a>
      {% endif %}
    </div>
  </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  const branchCodeInput = document.getElementById("id_branch_code");
  const branchNameInput = document.getElementById("id_branch_name");
  const providerInput = document.getElementById("id_provider");
  branchCodeInput.addEventListener("change", function() {
    fetch(`/api/branch-info/?branch_code=${branchCodeInput.value}`)
      .then(response => response.json())
      .then(data => {
        if (data.branch_name) {
          branchNameInput.value = data.branch_name;
        }
        if (data.provider) {
          providerInput.value = data.provider;
        }
      });
  });
});
</script>
{% endblock %}