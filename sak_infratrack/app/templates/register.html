{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>สมัครสมาชิก</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

  <style>
    @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap");
    :root{
      --card-w: 380px;
      --ring: 0 0 0 .15rem rgba(0,0,0,.08);
      --input-bg: #f7f8fa;
      --input-bd: #e5e7eb;
      --input-bd-focus: #c7c9d1;
      --btn: #222;
      --btn-hover:#111;
    }
    *{ font-family:"Poppins",sans-serif; }

    html,body{ height:100%; }
    body{
      margin:0;
      background:
        radial-gradient(600px 300px at 20% 15%, rgba(255,255,255,.25), transparent 60%),
        radial-gradient(600px 300px at 80% 85%, rgba(0,0,0,.06), transparent 60%),
        linear-gradient(#2463EB, #E0DFDF);
      display:flex; align-items:center; justify-content:center;
      padding:24px;
    }

    .auth-card{
      width:100%; max-width:var(--card-w);
      background:#fff; border-radius:20px;
      box-shadow: 0 10px 30px rgba(0,0,0,.15), 0 1px 0 rgba(255,255,255,.6) inset;
      padding:26px 24px 20px;
    }

    .avatar{
      width:86px; height:86px; border-radius:50%;
      margin:-60px auto 8px; background:#fff; display:grid; place-items:center;
      box-shadow: 0 8px 20px rgba(0,0,0,.12); border:4px solid #f0f1f3;
    }
    .avatar i{ font-size:40px; color:#9aa0a6; }

    .title{ text-align:center; font-weight:600; color:#111; margin:6px 0 14px; font-size:22px; }

    .input-wrap{ position:relative; margin-bottom:14px; }
    .input-wrap i.left{
      position:absolute; left:14px; top:50%; transform:translateY(-50%);
      color:#9aa0a6; font-size:16px;
    }
    .form-control{
      height:48px; border-radius:28px;
      background:#f7f8fa; border:1px solid var(--input-bd);
      padding-left:42px; padding-right:44px; color:#111; box-shadow: var(--ring);
    }
    .form-control::placeholder{ color:#9aa0a6; }
    .form-control:focus{
      background:#fff; border-color:var(--input-bd-focus);
      box-shadow: 0 0 0 .2rem rgba(33,33,33,.06);
      color:#111;
    }

    .toggle-pass{
      position:absolute; right:12px; top:50%; transform:translateY(-50%);
      border:0; background:transparent; color:#666; cursor:pointer;
    }

    .btn-primary-dark{
      width:100%; height:46px; border-radius:26px; border:0;
      background:var(--btn); color:#fff; font-weight:600;
      box-shadow: 0 8px 18px rgba(0,0,0,.18);
      transition: background .2s, transform .05s;
    }
    .btn-primary-dark:hover{ background:var(--btn-hover); }
    .btn-primary-dark:active{ transform: translateY(1px); }

    .foot{ text-align:center; font-size:12px; color:#6b7280; margin-top:12px; }
    .foot a{ color:#111; text-decoration:none; border-bottom:1px dotted #bbb; }
    .foot a:hover{ color:#000; }

    .alert-slim{
      background:#fff3f3; color:#b91c1c; border:1px solid #fecaca;
      border-radius:12px; padding:8px 10px; font-size:13px; margin-bottom:12px;
    }
  </style>
</head>
<body>

  <main class="auth-card position-relative">
    <div class="avatar">
      <img src="{% static 'img/sak.png' %}" alt="avatar" style="width:60%; height:60%; object-fit:contain;">
    </div>
    <h1 class="title">สมัครสมาชิก</h1>

    {% if form.errors %}
      <div class="alert-slim" role="alert">
        {% for f in form %}{% for e in f.errors %}{{ e }}<br/>{% endfor %}{% endfor %}
        {% for e in form.non_field_errors %}{{ e }}<br/>{% endfor %}
      </div>
    {% endif %}

    <form method="post" novalidate>
      {% csrf_token %}

      <div class="input-wrap">
        <i class="bi bi-person left"></i>
        {{ form.username }}
      </div>

      <div class="input-wrap">
        <i class="bi bi-envelope left"></i>
        {{ form.email }}
      </div>

      <div class="input-wrap">
        <i class="bi bi-lock left"></i>
        {{ form.password }}
        <button type="button" id="togglePwd" class="toggle-pass" aria-label="แสดง/ซ่อนรหัสผ่าน">
          <i class="bi bi-eye"></i>
        </button>
      </div>

      <div id="capsHint" class="text-center mt-2" style="display:none; font-size:12px; color:#eab308;">
        ↪ เปิด Caps Lock อยู่
      </div>

      <button id="btnRegister" class="btn-primary-dark" type="submit">สมัครสมาชิก</button>
    </form>

    <div class="foot">
      มีสมัครสมาชิกอยู่แล้ว?
      <a href="{% url 'login' %}">เข้าสู่ระบบ</a>
    </div>
  </main>

  <script>
    // ตาโชว์/ซ่อนรหัส + CapsLock + กันกดซ้ำ
    (function(){
      const pwd = document.querySelector('input[name="password"]') || document.querySelector('input[type="password"]');
      const toggle = document.getElementById('togglePwd');
      const caps = document.getElementById('capsHint');
      const btn = document.getElementById('btnRegister');
      const form = document.querySelector('form');

      toggle?.addEventListener('click', () => {
        const show = pwd.type === 'password';
        pwd.type = show ? 'text' : 'password';
        toggle.innerHTML = show ? '<i class="bi bi-eye-slash"></i>' : '<i class="bi bi-eye"></i>';
        toggle.setAttribute('aria-pressed', String(show));
        pwd.focus();
      });

      const onCaps = e => {
        const isOn = e.getModifierState && e.getModifierState('CapsLock');
        caps.style.display = isOn ? 'block' : 'none';
      };
      ['keyup','keydown','focus'].forEach(ev => pwd?.addEventListener(ev, onCaps));

      form?.addEventListener('submit', () => {
        btn.disabled = true;
        btn.textContent = 'กำลังสมัครสมาชิก…';
      });
    })();
  </script>
</body>
</html>
